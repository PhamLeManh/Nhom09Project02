@model IEnumerable<MdpProject.Models.MdpLaptop>

@{
    ViewData["Title"] = "Laptop Store";
    Layout = "~/Views/Shared/_MDPLayout.cshtml";

    var selectedCpu = Context.Request.Query["cpu"].ToString();
    var selectedRam = Context.Request.Query["ram"].ToString();
    var selectedGpu = Context.Request.Query["gpu"].ToString();

    var filteredModel = Model;

    if (!string.IsNullOrEmpty(selectedCpu))
        filteredModel = filteredModel.Where(x => !string.IsNullOrEmpty(x.MdpCpu) && x.MdpCpu.Contains(selectedCpu)).ToList();
    if (!string.IsNullOrEmpty(selectedRam))
        filteredModel = filteredModel.Where(x => !string.IsNullOrEmpty(x.MdpRam) && x.MdpRam.Contains(selectedRam)).ToList();
    if (!string.IsNullOrEmpty(selectedGpu))
        filteredModel = filteredModel.Where(x => !string.IsNullOrEmpty(x.MdpGpu) && x.MdpGpu.Contains(selectedGpu)).ToList();

    var random = new Random();

    string GetRandomImage()
    {
        if (!filteredModel.Any()) return "/images/placeholder.png";
        var laptop = filteredModel.ElementAt(random.Next(filteredModel.Count()));
        return string.IsNullOrEmpty(laptop.MdpAnh) ? "/images/placeholder.png" : laptop.MdpAnh;
    }
}

<!-- ================= FILTER FORM ================= -->
<div class="container my-4">
    <div class="row g-3 align-items-center">
        <div class="col-md-5">
            <input type="text" id="searchLaptop" class="form-control shadow-sm" placeholder="🔍 Tìm laptop theo tên..." onkeyup="filterLaptopsClient()" />
        </div>
        <div class="col-md-2">
            <select id="filterCpuClient" class="form-select shadow-sm" onchange="filterLaptopsClient()">
                <option value="">CPU</option>
                <option value="Intel i5">Intel i5</option>
                <option value="Intel i7">Intel i7</option>
                <option value="AMD Ryzen 5">AMD Ryzen 5</option>
            </select>
        </div>
        <div class="col-md-2">
            <select id="filterRamClient" class="form-select shadow-sm" onchange="filterLaptopsClient()">
                <option value="">RAM</option>
                <option value="8GB">8GB</option>
                <option value="16GB">16GB</option>
                <option value="32GB">32GB</option>
            </select>
        </div>
        <div class="col-md-2">
            <select id="filterGpuClient" class="form-select shadow-sm" onchange="filterLaptopsClient()">
                <option value="">GPU</option>
                <option value="GTX 1650">GTX 1650</option>
                <option value="RTX 3060">RTX 3060</option>
                <option value="RTX 4070">RTX 4070</option>
            </select>
        </div>
        <div class="col-md-1">
            <button class="btn btn-outline-secondary w-100 shadow-sm" onclick="resetFilters()">Reset</button>
        </div>
    </div>
</div>

<!-- ================= DANH SÁCH LAPTOP ================= -->
<div class="text-center py-3 mb-4" style="background: linear-gradient(to right, #4e54c8, #8f94fb); color: white; border-radius: 8px;">
    <h2 class="mb-0 fw-bold">💻 DANH SÁCH LAPTOP</h2>
</div>

<div id="laptopContainer" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-3">
    @foreach (var laptop in filteredModel)
    {
        <div class="col laptop-item card-hover" data-cpu="@laptop.MdpCpu" data-ram="@laptop.MdpRam" data-gpu="@laptop.MdpGpu">
            <div class="card h-100 shadow-lg border-0 rounded-3 overflow-hidden">
                <img src="@(string.IsNullOrEmpty(laptop.MdpAnh) ? "/images/placeholder.png" : laptop.MdpAnh)"
                     class="card-img-top" style="height:200px; object-fit:cover;" />
                <div class="card-body p-3">
                    <h6 class="card-title text-truncate fw-bold" title="@laptop.MdpTenLaptop">@laptop.MdpTenLaptop</h6>
                    <p class="mb-1"><strong>CPU:</strong> @laptop.MdpCpu</p>
                    <p class="mb-1"><strong>RAM:</strong> @laptop.MdpRam</p>
                    <p class="mb-1"><strong>GPU:</strong> @laptop.MdpGpu</p>
                    <p class="mt-2 mb-0">
                        <span class="badge bg-success me-1">Còn hàng</span>
                        <span class="fw-bold text-danger">Liên hệ</span>
                    </p>
                </div>
                <div class="card-footer text-center bg-light border-0 p-2 d-flex justify-content-center gap-2">
                    <a href="@Url.Action("Details", "MdpLaptops", new { id = laptop.MdpLaptopId })"
                       class="btn btn-outline-primary btn-sm fw-bold px-3 py-2">
                        <i class="bi bi-eye me-1"></i> Xem
                    </a>
                    <a href="@Url.Action("Index", "MdpProductVariants", new { sanPhamId = laptop.MdpSanPhamId })"
                       class="btn btn-success btn-sm fw-bold">Mua</a>
                </div>
            </div>
        </div>
    }
</div>

<!-- ================= HOT ================= -->
<div class="text-center py-3 my-4" style="background: linear-gradient(45deg,#ff9800,#ffc107); color:#fff; border-radius:8px;">
    <h2 class="mb-0 fw-bold">🔥 SẢN PHẨM HOT</h2>
</div>
<div class="row row-cols-1 row-cols-md-4 g-3">
    @for (int i = 0; i < 4; i++)
    {
        <div class="col card-hover">
            <div class="card h-100 shadow-lg border-0 rounded-3 position-relative">
                <span class="badge bg-danger position-absolute top-0 start-0 m-2">Hot</span>
                <img src="@GetRandomImage()" class="card-img-top" style="height:160px; object-fit:cover;" />
                <div class="card-body p-2 text-center">
                    <small class="fw-bold">Laptop nổi bật</small>
                    <p class="fw-bold text-danger mb-0">10,000,000₫</p>
                </div>
            </div>
        </div>
    }
</div>

<!-- ================= KHUYẾN MÃI ================= -->
<div class="text-center py-3 my-4" style="background: linear-gradient(45deg,#f44336,#e91e63); color:white; border-radius:8px;">
    <h2 class="mb-0 fw-bold">💥 KHUYẾN MÃI</h2>
</div>
<div class="row row-cols-1 row-cols-md-4 g-3">
    @for (int i = 0; i < 4; i++)
    {
        <div class="col card-hover">
            <div class="card h-100 shadow-lg border-0 rounded-3 position-relative">
                <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2">Sale</span>
                <img src="@GetRandomImage()" class="card-img-top" style="height:160px; object-fit:cover;" />
                <div class="card-body p-2 text-center">
                    <small class="fw-bold">Khuyến mãi hot</small>
                    <p class="text-muted text-decoration-line-through mb-0">12,000,000₫</p>
                    <p class="text-danger fw-bold mb-0">10,000,000₫</p>
                </div>
            </div>
        </div>
    }
</div>
