@model IEnumerable<MdpProject.Models.MdpChiTietDonHang>

@{
    ViewData["Title"] = "Quản lý chi tiết đơn hàng";
    Layout = "~/Views/Shared/_MdpAdminLayout.cshtml";
}

<div class="container py-4">
    <h2 class="mb-4"><i class="bi bi-card-list"></i> Quản lý chi tiết đơn hàng</h2>

    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-3">
            <div class="table-responsive">
                <table class="table table-hover table-striped align-middle text-center">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Đơn hàng</th>
                            <th>Sản phẩm</th>
                            <th>Màu</th>
                            <th>Dung lượng</th>
                            <th>Số lượng</th>
                            <th>Giá</th>
                            <th>Giảm giá</th>
                            <th>Thành tiền</th>
                            <th>Ngày đặt</th>
                            <th>Thanh toán</th>
                            <th>Trạng thái</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            int index = 1;
                            foreach (var item in Model)
                            {
                                var gia = item.MdpGia;                       // decimal
                                var soLuong = item.MdpSoLuong;              // int
                                var giamGia = item.MdpGiamGia ?? 0m;       // decimal?
                                var thanhTien = item.MdpThanhTien ?? (gia * soLuong);

                                <tr>
                                    <td>@index</td>
                                    <td><span class="badge bg-primary">#@item.MdpDonHangId</span></td>
                                    <td>
                                        <i class="bi bi-box-seam me-1"></i>
                                        @item.MdpVariant?.MdpSanPham?.MdpTenSanPham ?? "N/A"
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.MdpVariant?.MdpMauSac?.MdpTenMau))
                                        {
                                            <span class="badge" style="background-color:@item.MdpVariant.MdpMauSac.MdpMaHex; color:#fff;" title="@item.MdpVariant.MdpMauSac.MdpTenMau">
                                                @item.MdpVariant.MdpMauSac.MdpTenMau
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">—</span>
                                        }
                                    </td>
                                    <td>@item.MdpVariant?.MdpDungLuong ?? "—"</td>
                                    <td>@soLuong</td>
                                    <td>@gia.ToString("N0")₫</td>
                                    <td>@giamGia.ToString("N0")₫</td>
                                    <td>@thanhTien.ToString("N0")₫</td>
                                    <td>@item.MdpDonHang?.MdpNgayDatDonHang?.ToString("dd/MM/yyyy HH:mm") ?? "—"</td>
                                    <td>
                                        @if (item.MdpDonHang?.MdpTrangThaiThanhToan == "paid")
                                        {
                                            <span class="badge bg-success" title="Đã thanh toán"><i class="bi bi-check-circle"></i> Paid</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning text-dark" title="Chưa thanh toán"><i class="bi bi-x-circle"></i> Unpaid</span>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge bg-info text-dark" title="Trạng thái đơn hàng">
                                            @item.MdpDonHang?.MdpStatus ?? "—"
                                        </span>
                                    </td>
                                    <td class="d-flex justify-content-center gap-1">
                                        <a asp-action="Details" asp-route-id="@item.MdpChiTietDonHangId" class="btn btn-sm btn-info" data-bs-toggle="tooltip" title="Xem chi tiết">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.MdpChiTietDonHangId" class="btn btn-sm btn-danger" data-bs-toggle="tooltip" title="Xóa">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                index++;
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="13" class="text-center text-muted py-3">Chưa có chi tiết đơn hàng nào</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Quay lại danh sách đơn hàng</a>
    </div>
</div>

@section Scripts {
    <script>
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
}
